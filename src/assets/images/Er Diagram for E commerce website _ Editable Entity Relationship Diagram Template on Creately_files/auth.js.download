/**
 * This component manages Graivty Authentication for all necessary
 * functionality in the site.
 * 
 * Contain functionality to handle gravity client library functions,
 * this will be accessible on the browser global scope.
 */
window.gravityAuth = (function () {

    /**
     * Removes the given cookie.
     * @param name is the name of the cookie
     */
    var removeCookie = function( name ){
        document.cookie = name + '=; path=/; domain=' + gravity.client.getCookieDomain() + '; expires=' + new Date(0).toUTCString();
    }

    /**
     * returns true if the demo cookie is 
     * available.
     */
    var hasDemoCookie = function(){
        return document.cookie.indexOf('creately_demo') >= 0;
    } 

    /**
     * Remove creately demo cookie and JSESSIONID cookie.
     */
    var removeSessionCookies = function(){
        removeCookie( 'creately_demo' );
        removeCookie( 'JSESSIONID' );
    }

    /**
     * Remove current Drupal session in user logout.
     * If left the session as it is, boost caching interfere with authenticated users.
     */
    var removeDrupalSessionCookie = function() {
        /**
         * Define name of the Drupal session cookie.
         * Session cookie name is generated by concatanating 
         * SESS + md5(cookie domain on setting file)
         */
        var DRUPAL_SESSION_COOKIE_NAME = 'SESS9f180724c55cd2f1a2dca2997f588020';

        removeCookie( DRUPAL_SESSION_COOKIE_NAME );
    }

    return {
        
        /**
         * User action types
         * This will be used to identify which gravity client widget to be shown.
         */
        TYPE_LOGIN: 'TYPE_LOGIN',
        TYPE_SIGNUP: 'TYPE_SIGNUP',

        /**
         * Logout users
         * Call gravity logout function,
         * remove creately_demo and JSESSIONID cookies,
         * then redirect user to home page
         */
         logOutUser: function() {
            
            // Call gravity client logout function, this will remove gravity token
            gravity.client.logOut();
            
            // Remove creately demo and JSESSIONID cookies
            removeSessionCookies();

            // Remove current Drupal session
            removeDrupalSessionCookie();

            // User redirect to home page
            window.location = '/';
        },
		
        /**
         * This function returns true when the application is being accessed 
         * in demo mode. The basis for the check is the presence of creately
         * demo cookie.
         */
		isDemoUser : function () {			
			return hasDemoCookie();
		},
    };


})();